<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rail-Fond EPS - Version Dynamique</title>
    <style>
        :root { 
            --p: #2c3e50; 
            --s: #27ae60; 
            --accent: #f39c12;
            --bg-dark: #1a1a2e;
            --glass: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', 'Segoe UI', sans-serif; background: #f0f2f5; min-height: 100vh; overflow: hidden; }

        /* --- NOUVEAU DESIGN ACCUEIL PUNCHY --- */
        .home-container { 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: radial-gradient(circle at center, #2e3192, #1b1464);
            padding: 20px; 
            position: fixed; 
            inset: 0; 
            z-index: 1000;
            overflow: hidden;
        }

        /* Effet de particules en fond */
        .home-container::before {
            content: "";
            position: absolute;
            width: 200%;
            height: 200%;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
            opacity: 0.3;
            animation: moveBackground 100s linear infinite;
        }

        @keyframes moveBackground {
            from { transform: translate(0,0); }
            to { transform: translate(-50%, -50%); }
        }

        .wrapper { max-width: 900px; width: 100%; text-align: center; position: relative; z-index: 2; }
        
        .header-home h1 { 
            color: white; 
            font-size: clamp(2rem, 8vw, 4rem);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 5px 15px rgba(0,0,0,0.5), 0 0 20px rgba(102, 126, 234, 0.5);
            margin-bottom: 10px;
        }
        .header-home p { color: #00d2ff; font-weight: bold; text-transform: uppercase; letter-spacing: 3px; margin-bottom: 50px; }

        .cards { display: grid; gap: 30px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        
        .card-menu { 
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 30px; 
            padding: 50px 30px; 
            cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            color: white;
            position: relative;
            overflow: hidden;
        }

        /* Effet de surbrillance au survol */
        .card-menu::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: 0.5s;
        }

        .card-menu:hover::after { left: 100%; }

        .card-menu:hover { 
            transform: scale(1.05); 
            border-color: #00d2ff;
            box-shadow: 0 0 30px rgba(0, 210, 255, 0.4);
            background: rgba(255,255,255,0.15);
        }

        .card-icon { font-size: 80px; margin-bottom: 20px; display: block; filter: drop-shadow(0 0 10px rgba(255,255,255,0.5)); }
        .card-title { font-size: 28px; font-weight: 800; margin-bottom: 15px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .card-desc { color: rgba(255,255,255,0.8); line-height: 1.5; font-size: 0.95rem; }

        .btn-start {
            margin-top: 20px;
            display: inline-block;
            padding: 10px 25px;
            background: #00d2ff;
            border-radius: 50px;
            color: #1b1464;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        /* --- LE RESTE RESTE IDENTIQUE --- */
        #interface-eleve, #interface-prof { display: none; height: 100vh; width: 100%; flex-direction: row; }
        #sidebar { width: 340px; background: white; border-right: 2px solid #ddd; display: flex; flex-direction: column; overflow-y: auto; flex-shrink: 0; z-index: 10; }
        .padding { padding: 15px; }
        #map-area { flex-grow: 1; background: #cbdceb; overflow: auto; position: relative; display: flex; align-items: flex-start; justify-content: center; }
        #map-container { transform-origin: top center; transition: transform 0.2s ease; }
        embed { width: 1000px; height: 960px; pointer-events: none; }
        .controls-map { position: absolute; top: 10px; right: 10px; z-index: 20; display: flex; gap: 5px; }
        .btn-map { background: rgba(0,0,0,0.7); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .ui-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 12px; margin-bottom: 10px; border-left: 5px solid var(--p); }
        .player-row { display: flex; justify-content: space-between; padding: 12px; background: #f8f9fa; border-radius: 6px; margin-bottom: 6px; cursor: pointer; border: 1px solid #eee; }
        .inventory { display: flex; flex-wrap: wrap; gap: 4px; margin: 10px 0; }
        .wagon-pill { padding: 6px 10px; border-radius: 5px; font-weight: bold; border: 1px solid #333; font-size: 0.85rem; }
        .jaune { background: #FFD700; color: #000; } 
        .blanc { background: #fff; color: #000; border: 1px solid #ccc; }
        .orange { background: #FF8C00; color: #fff; } 
        .rose { background: #FF69B4; color: #fff; } 
        .noire { background: #222; color: #fff; } 
        .vert { background: #2E7D32; color: #fff; } 
        .bleu { background: #1E90FF; color: #fff; } 
        .rouge { background: #DC143C; color: #fff; }
        button { background: var(--p); color: white; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; }
        select, input { width: 100%; padding: 12px; margin-top: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; text-align: center; width: 90%; max-width: 400px; }
    </style>
</head>
<body>

    <div id="screen-home" class="home-container">
        <div class="wrapper">
            <div class="header-home">
                <h1>Les Aventuriers <br> du Rail-Fond</h1>
                <p>‚Äî Edition EPS Pro ‚Äî</p>
            </div>
            <div class="cards">
                <div class="card-menu" onclick="showInterface('eleve')">
                    <span class="card-icon">‚ö°</span>
                    <div class="card-title">√âQUIPE √âL√àVE</div>
                    <p class="card-desc">Rejoignez la mission, courez et connectez les villes de France.</p>
                    <div class="btn-start">Entrer dans le jeu</div>
                </div>
                <div class="card-menu" onclick="checkProfAccess()">
                    <span class="card-icon">üîê</span>
                    <div class="card-title">ESPACE PROF</div>
                    <p class="card-desc">Acc√®s s√©curis√© pour la gestion de classe et les r√©sultats.</p>
                    <div class="btn-start" style="background:#f39c12">Acc√®s Enseignant</div>
                </div>
            </div>
        </div>
    </div>

    <div id="interface-prof">
        <div class="padding" style="width:100%; background: white;">
            <button onclick="goHome()" style="width: auto; margin-bottom: 20px; background:#7f8c8d;">‚Üê Retour</button>
            <h1>Interface Enseignant</h1><hr>
            <div style="margin-top: 50px; text-align: center; color: #666;"><p>Page en attente de configuration.</p></div>
        </div>
    </div>

    <div id="interface-eleve">
        <div id="sidebar">
            <div class="padding">
                <button onclick="goHome()" style="background:#7f8c8d; margin-bottom:15px; font-size: 0.8rem;">‚Üê Quitter</button>
                <div id="setup-zone">
                    <h2>üöÇ Nouveau Groupe</h2>
                    <input type="text" id="names-input" placeholder="Julie, Marc, Paul...">
                    <button onclick="startSession()" style="margin-top: 15px; background: var(--s);">Lancer la Mission</button>
                </div>
                <div id="game-zone" style="display:none">
                    <div class="ui-card" style="background: var(--p); color: white;">
                        <small>MISSION :</small><br><strong id="m-title" style="font-size: 1.1rem;">---</strong>
                    </div>
                    <div id="players-list"></div>
                    <div id="inventory-zone" class="inventory"></div>
                    <div class="ui-card">
                        <select id="sel-a"></select><select id="sel-b"></select>
                        <button onclick="buildRoute()" style="background:var(--s); margin-top: 15px;">Valider le trajet</button>
                    </div>
                    <div class="ui-card" style="border-left-color: #95a5a6;"><small>üìú R√©capitulatif :</small><div id="history-log" style="margin-top:5px; max-height: 120px; overflow-y:auto"></div></div>
                </div>
            </div>
        </div>
        <div id="map-area">
            <div class="controls-map">
                <button class="btn-map" onclick="zoomMap(0.1)">+</button>
                <button class="btn-map" onclick="zoomMap(-0.1)">-</button>
                <button class="btn-map" onclick="fitMap()">Ajuster</button>
            </div>
            <div id="map-container"><embed src="carte.svg" type="image/svg+xml"></div>
        </div>
    </div>

    <div id="modal-chance" class="modal"><div class="modal-content"><h3>Tour valid√© ! (+250m)</h3><div id="chance-buttons" class="inventory" style="justify-content:center"></div></div></div>
    <div id="modal-win" class="modal"><div class="modal-content" style="background:gold"><h1>üèÜ</h1><h2>MISSION R√âUSSIE !</h2><button onclick="location.reload()" style="background:black; margin-top:20px;">Fermer</button></div></div>

    <script>
        // --- TOUTE LA LOGIQUE TECHNIQUE R√âCUP√âR√âE ---
        const RAIL_DATA = [
            {u:"Calais", v:"Dunkerque", cost:1, col:["jaune"]}, {u:"Dunkerque", v:"Lille", cost:2, col:["bleu"]},
            {u:"Dunkerque", v:"B√©thune", cost:3, col:["rouge"]}, {u:"B√©thune", v:"Douai", cost:1, col:["blanc"]},
            {u:"Douai", v:"Amiens", cost:2, col:["bleu"]}, {u:"Douai", v:"Valenciennes", cost:2, col:["noire"]},
            {u:"Lille", v:"Valenciennes", cost:4, col:["orange"]}, {u:"Valenciennes", v:"Thionville", cost:5, col:["noire","rose"]},
            {u:"Valenciennes", v:"Reims", cost:2, col:["jaune"]}, {u:"Amiens", v:"Paris", cost:3, col:["orange","vert"]},
            {u:"Amiens", v:"Le Havre", cost:4, col:["rouge"]}, {u:"Le Havre", v:"Rouen", cost:2, col:["noire"]},
            {u:"Rouen", v:"Paris", cost:3, col:["blanc"]}, {u:"Paris", v:"Troyes", cost:7, col:["rose","jaune"]},
            {u:"Reims", v:"Nancy", cost:5, col:["rouge"]}, {u:"Reims", v:"Troyes", cost:4, col:["vert"]},
            {u:"Thionville", v:"Nancy", cost:3, col:["orange"]}, {u:"Thionville", v:"Strasbourg", cost:5, col:["rose"]},
            {u:"Nancy", v:"Strasbourg", cost:4, col:["jaune"]}, {u:"Strasbourg", v:"Mulhouse", cost:3, col:["blanc"]},
            {u:"Mulhouse", v:"Montb√©liard", cost:1, col:["vert"]}, {u:"Montb√©liard", v:"Besan√ßon", cost:2, col:["jaune"]},
            {u:"Besan√ßon", v:"Troyes", cost:3, col:["rouge","vert"]}, {u:"Besan√ßon", v:"Dijon", cost:2, col:["bleu"]},
            {u:"Besan√ßon", v:"Annecy", cost:4, col:["blanc"]}, {u:"Dijon", v:"Lyon", cost:4, col:["jaune","rouge"]},
            {u:"Le Havre", v:"Caen", cost:1, col:["bleu"]}, {u:"Paris", v:"Le Mans", cost:4, col:["vert"]},
            {u:"Paris", v:"Orl√©ans", cost:4, col:["rouge","bleu"]}, {u:"Orl√©ans", v:"Le Mans", cost:3, col:["blanc"]},
            {u:"Le Mans", v:"Rennes", cost:5, col:["vert"]}, {u:"Caen", v:"Le Mans", cost:4, col:["orange"]},
            {u:"Caen", v:"Rennes", cost:5, col:["blanc","rose"]}, {u:"Rennes", v:"Brest", cost:7, col:["rouge"]},
            {u:"Brest", v:"Lorient", cost:3, col:["orange"]}, {u:"Lorient", v:"Saint-Nazaire", cost:3, col:["jaune"]},
            {u:"Rennes", v:"Saint-Nazaire", cost:3, col:["noire"]}, {u:"Rennes", v:"Nantes", cost:3, col:["bleu"]},
            {u:"Nantes", v:"Saint-Nazaire", cost:2, col:["blanc"]}, {u:"Nantes", v:"Angers", cost:2, col:["rouge"]},
            {u:"Angers", v:"Tours", cost:3, col:["bleu"]}, {u:"Tours", v:"Orl√©ans", cost:3, col:["vert"]},
            {u:"Nantes", v:"Poitiers", cost:5, col:["rose"]}, {u:"Tours", v:"Poitiers", cost:2, col:["blanc"]},
            {u:"Nantes", v:"Bordeaux", cost:8, col:["noire","orange"]}, {u:"Poitiers", v:"Limoges", cost:3, col:["rouge"]},
            {u:"Limoges", v:"Bordeaux", cost:5, col:["vert","bleu"]}, {u:"Limoges", v:"Clermont-Ferrand", cost:4, col:["blanc","jaune"]},
            {u:"Clermont-Ferrand", v:"Lyon", cost:2, col:["orange"]}, {u:"Clermont-Ferrand", v:"Saint-Etienne", cost:3, col:["rouge"]},
            {u:"Lyon", v:"Saint-Etienne", cost:1, col:["vert"]}, {u:"Lyon", v:"Grenoble", cost:4, col:["bleu"]},
            {u:"Grenoble", v:"Annecy", cost:3, col:["vert"]}, {u:"Saint-Etienne", v:"Valence", cost:2, col:["noire"]},
            {u:"Valence", v:"N√Æmes", cost:4, col:["rouge","jaune"]}, {u:"N√Æmes", v:"Montpellier", cost:2, col:["orange","bleu"]},
            {u:"N√Æmes", v:"Marseille", cost:1, col:["blanc","bleu"]}, {u:"Marseille", v:"Toulon", cost:2, col:["jaune"]},
            {u:"Toulon", v:"Nice", cost:3, col:["vert"]}, {u:"Montpellier", v:"Toulouse", cost:4, col:["rouge","vert"]},
            {u:"Toulouse", v:"Perpignan", cost:3, col:["blanc"]}, {u:"Toulouse", v:"Pau", cost:5, col:["jaune"]},
            {u:"Toulouse", v:"Bordeaux", cost:6, col:["rose"]}, {u:"Bordeaux", v:"Pau", cost:6, col:["rouge"]},
            {u:"Pau", v:"Bayonne", cost:4, col:["vert"]}
        ];

        const MISSIONS = {
            3: [{s:"Brest", e:"Orl√©ans"}, {s:"Dunkerque", e:"Troyes"}, {s:"Caen", e:"Poitiers"}],
            4: [{s:"Calais", e:"Strasbourg"}, {s:"Nice", e:"Bordeaux"}, {s:"Lorient", e:"Dijon"}],
            5: [{s:"Bayonne", e:"Strasbourg"}, {s:"Brest", e:"Nice"}]
        };

        let state = { scale: 1, players: [], inv: {jaune:0,orange:0,rose:0,noire:0,vert:0,bleu:0,rouge:0,blanc:0}, mission: null, built: [] };

        function showInterface(type) { document.getElementById('screen-home').style.display = 'none'; document.getElementById('interface-' + type).style.display = 'flex'; }
        function goHome() { location.reload(); }
        function checkProfAccess() { const mdp = prompt("Code :"); if(mdp === "EPS") showInterface('prof'); else alert("Non."); }

        function startSession() {
            const names = document.getElementById('names-input').value; if(!names) return;
            state.players = names.split(',').map(n => ({name: n.trim(), d: 0}));
            const pool = MISSIONS[state.players.length] || MISSIONS[3];
            state.mission = pool[Math.floor(Math.random()*pool.length)];
            const cities = [...new Set(RAIL_DATA.flatMap(r=>[r.u,r.v]))].sort();
            [document.getElementById('sel-a'), document.getElementById('sel-b')].forEach(s => cities.forEach(c => s.add(new Option(c,c))));
            document.getElementById('m-title').innerText = state.mission.s + " ‚ûî " + state.mission.e;
            document.getElementById('setup-zone').style.display = 'none'; document.getElementById('game-zone').style.display = 'block';
            setTimeout(fitMap, 300); updateUI();
        }

        function addLap(idx) {
            state.players[idx].d += 250;
            const modal = document.getElementById('modal-chance'), cont = document.getElementById('chance-buttons');
            cont.innerHTML = "";
            const pick = Object.keys(state.inv).sort(()=>0.5-Math.random()).slice(0,4);
            pick.forEach(c => {
                const b = document.createElement('button'); b.className = `wagon-pill ${c}`; b.innerText = c.toUpperCase(); b.style.width="45%";
                b.onclick = () => { state.inv[c]++; modal.style.display="none"; updateUI(); };
                cont.appendChild(b);
            });
            modal.style.display = "flex";
        }

        function buildRoute() {
            const a = document.getElementById('sel-a').value, b = document.getElementById('sel-b').value;
            const rail = RAIL_DATA.find(r => (r.u==a && r.v==b) || (r.u==b && r.v==a));
            if(!rail || state.built.find(r=>(r.u==a&&r.v==b)||(r.v==a&&r.u==b))) return alert("Invalide ou d√©j√† pos√©.");
            let col = rail.col.length > 1 ? prompt(`Couleur ? (${rail.col.join('/')})`).toLowerCase() : rail.col[0];
            if(state.inv[col] >= rail.cost) {
                state.inv[col] -= rail.cost; state.built.push({u:a, v:b, c:col});
                document.getElementById('history-log').innerHTML = `<div>‚úîÔ∏è ${a}-${b}</div>` + document.getElementById('history-log').innerHTML;
                updateUI(); checkWin();
            } else alert("Wagons insuffisants.");
        }

        function checkWin() {
            let visited = new Set(), q = [state.mission.s];
            while(q.length > 0) {
                let curr = q.shift(); if(curr == state.mission.e) return document.getElementById('modal-win').style.display='flex';
                visited.add(curr);
                state.built.forEach(r => { if(r.u==curr && !visited.has(r.v)) q.push(r.v); if(r.v==curr && !visited.has(r.u)) q.push(r.u); });
            }
        }

        function updateUI() {
            const pl = document.getElementById('players-list'); pl.innerHTML = "<h3>üèÉ Coureurs</h3>";
            state.players.forEach((p, i) => { pl.innerHTML += `<div class="player-row" onclick="addLap(${i})"><span>${p.name}</span><b>${p.d}m</b></div>`; });
            const iz = document.getElementById('inventory-zone'); iz.innerHTML = "";
            for(let c in state.inv) if(state.inv[c]>0) iz.innerHTML += `<div class="wagon-pill ${c}">${state.inv[c]}</div>`;
        }

        function zoomMap(val) { state.scale += val; applyZoom(); }
        function fitMap() { state.scale = (document.getElementById('map-area').clientWidth - 40) / 1000; applyZoom(); }
        function applyZoom() { document.getElementById('map-container').style.transform = `scale(${state.scale})`; }
    </script>
</body>
</html>